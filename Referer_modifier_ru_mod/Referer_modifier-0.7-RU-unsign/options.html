<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style type="text/css">
      body {
      font: message-box;
      font-size: 1.25rem;
      text-rendering: optimizeLegibility;
      }
      .documentation {
      max-width: 550px;
      text-align: justify;
      hyphens: auto;
      }
    </style>
  </head>

  <body>
    <section>
      <h3>Настройка рефереров</h3>
      <form id="ref_conf">
	<table>
	  <thead>
	    <tr id="header">
	      <th title="Домен запрашиваемого URL, также соответствует поддоменам">Целевой домен</th>
	      <th title="Что делать с реферером в запросе, соответствующему целевому домену">Действие</th>
	      <th title="Если выбрано &quot;Заменить&quot;, то для реферера устанавливается это значение">Замена реферера</th>
	    </tr>
	  </thead>
	  <tbody id="hosts">
	    <tr>
	      <td title="Применяется к любому запросу, который не соответствует другим правилам">&lt;ЛЮБОЙ&gt;</td>
	      <td>
		<select id="any_action" class="action">
		  <option value="keep" title="Не изменять реферер">Оставить</option>
		  <option value="prune" title="Отправить часть исходного реферера (схема, хост и порт)">Обрезать</option>
		  <option value="target" title="Отправить короткий целевой реферер (схема, хост и порт)">Целевой</option>
		  <option value="remove" title="Не отправлять реферер">Убрать</option>
		  <option value="replace" title="Заменить значениями указанными в поле &quot;Замена реферера&quot;">Заменить</option>
		</select>
	      </td>
	      <td><input id="any_referer" class="referer" type="text"
			 title="Если выбрано &quot;Заменить&quot;, то для реферера устанавливается это значение"
			 value=""/></td>
	    </tr>
	    <tr>
	      <td title="Применяется к запросам, в которых целевой и исходный домен совпадают, но только если для этого домена не существует отдельного правила">&lt;ТОТ ЖЕ&gt;</td>
	      <td>
		<select id="same_action" class="action">
		  <option value="keep" title="Не изменять реферер">Оставить</option>
		  <option value="prune" title="Отправить часть исходного реферера (схема, хост и порт)">Обрезать</option>
		  <option value="target" title="Отправить короткий целевой реферер (схема, хост и порт)">Целевой</option>
		  <option value="remove" title="Не отправлять реферер">Убрать</option>
		  <option value="replace" title="Заменить значениями указанными в поле &quot;Замена реферера&quot;">Заменить</option>
		</select>
	      </td>
	      <td><input id="same_referer" class="referer" type="text"
			 title="Если выбрано &quot;Заменить&quot;, то для реферера устанавливается это значение"
			 value=""/></td>
	    </tr>
	  </tbody>
	</table>
	<button type="button" id="add_row">Добавить</button>
	<button type="button" id="safe_conf">Сохранить настройки</button>
      </form>
      <p class="documentation">"Оставить" = Не изменять реферер</p>
      <p class="documentation">"Обрезать" = Отправить часть исходного реферера (схема, хост и порт)</p>
      <p class="documentation">"Целевой" = Отправить короткий целевой реферер (схема, хост и порт)</p>
      <p class="documentation">"Убрать" = Не отправлять реферер</p>
      <p class="documentation">"Заменить" = Заменить значениями указанными в поле "Замена реферера"</p>
      <p class="documentation">При наведении курсора на поля настроек
      всплывают подсказки с подробностями о значении полей конфигурации.
      Домены также совпадают с поддоменами, если запрос соответствует
      нескольким правилам, то используется самое длинное совпадение.
      Например, если у вас есть отдельные правила для www.example.com
      и example.com, запрос к https://www.example.com/ будет подчиняться
      первому правилу.</p>
      <p class="documentation">Действия "Заменить" и "Целевой" добавят
      заголовок реферера в запрос, если это необходимо, другие действия
      вступят в силу только в том случае, если браузер отправит запрос
      по умолчанию.</p>
    </section>

    <section>
      <h3>Сохранение или восстановление настроек</h3>
      <p>
	<button type="button" id="export">Экспорт настроек</button>
	<div id="export_text" hidden>
	  Please save this <a id="export_blob">JSON file</a>.
	</div>
      </p>
      <p>
	<div>
	  <label for="import_file">Импорт настроек из файла</label>
	  <input type="file" id="import_file" name="import_file"
		 accept="application/json">
	</div>
	<div id="import_warn" hidden><strong>Предупреждение:</strong>
	  Импорт перезапишет ваши текущие настройки.
	  <div>
	    <button id="import_button" type="button" disabled>
	      Import configuration
	    </button>
	  </div>
	</div>
      </p>
    </section>

    <template id="ref_row">
      <tr class="ref_entry">
	<td><input class="hostname" type="text" placeholder="cdn.example.com"
		   title="Домен запрашиваемого URL, также соответствует поддоменам"
		   value=""/></td>
	<td>
	  <select class="action">
		  <option value="keep" title="Не изменять реферер">Оставить</option>
		  <option value="prune" title="Отправить часть исходного реферера (схема, хост и порт)">Обрезать</option>
		  <option value="remove" title="Не отправлять реферер">Убрать</option>
		  <option value="target" title="Отправить короткий целевой реферер (схема, хост и порт)">Целевой</option>
		  <option value="replace" title="Заменить значениями указанными в поле &quot;Замена реферера&quot;">Заменить</option>
	  </select>
	</td>
	<td><input class="referer" type="text"
		   placeholder="https://www.example.com/"
		   title="Если выбрано &quot;Заменить&quot;, то для реферера устанавливается это значение"
		   value=""/></td>
	<td>
	  <button type="button" title="Удалить строку" class="delete_row">
	    <b>-</b>
	  </button>
	</td>
      </tr>
    </template>
    <script src="options.js"></script>
  </body>
</html>
